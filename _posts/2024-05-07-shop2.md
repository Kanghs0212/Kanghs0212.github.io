---
layout: single
title:  "스프링부트를 이용하여 쇼핑몰 구현하기 2장"
categories: shop
toc: true
---
본 게시글은 변구훈님의 스프링부트 쇼핑몰 프로젝트 with JPA 책을 참고하여
공부한 내용을 정리한 글입니다.

### JPA
1. 상품 데이터를 관리하는 Item 클래스가 있고, 상품 데이터를 관계형 데이터베이스에서 관리하기 위해서 우리는 SQL문을 사용한다. SQL 중심 개발의 문제점: CRUD를 사용해 데이터베이스를 관리한다
- INSERT, UPDATE, SELECT, DELETE
- 이 때문에 자바 객체를 SQL을 통해 데이터베이스에서 관리하게 되고 데이터베이스에 저장된 데이터를 자바 애플리케이션에서 사용할려면 SQL을 통해 다시 자바 객체로 변환하는 반복적인 작업이 필요.

2. 객체와 관계형 데이터베이스의 패러다임의 불일치
- 자바는 객체 지향 패러다임, 관계형 데이터베이스는 데이터를 정규화해서 잘 보관하는 것이 목표
- 객체를 데이터베이스에 넣으려면 SQL문, 데이터베이스에서 객체를 꺼내오기 위해선 복잡한 SQL문 사용
- 따라서 단순 전달 목적 이외 객체지향적으로 프로그래밍 불가능

이를 위해서 나온 기술을 ORM이라고 한다.


#### ORM
- 객체는 객체지향적, 데이터베이스는 데이터베이스 대로 설계하면 ORM이 중간에서 2개를 매핑해주는 역할 수행
- 이를 통해 개발자는 조금 더 객체지향적으로 설계하고 비즈니스에 집중 가능.

여기서 ORM 기술의 표준 명세로 자바에서 제공하는 API가 바로 JPA인것

JPA 사용 시 장점
1. 특정 데이터베이스에 종속되지 않는다
- 내가 데이터베이스로 오라클을 사용하다가 오픈 소스 MariaDB로 변경한다 해도 JPA의 설정 파일에 어떤 데이터베이스를 사용하는지 알려주면 얼마든지 데이터베이스를 변경 가능함.
- 따라서 데이터베이스마다 쿼리문이 다른 문제로 전체를 수정해야하는 수고를 덜 수 있다. 

2. 객체지향적 프로그래밍
- JPA를 사용하여 데이터베이스 설계 중심의 패러다임에서 객체지향적 설계 가능
- 따라서 좀 더 직관적으로 이해 가능

3. 생산성 향상
- 원래라면 데이터베이스 테이블에 새로운 컬럼 추가시 해당 테이블의 컬럼을 사용하는 DTO클래스의 필드도 전부 변경해야함
- JPA에서는 테이블과 매핑된 클래스에 필드만 추가한다면 쉽게 관리
- SQL문을 직접 작성하지 않고 객체를 사용하여 동작하기에 유지보수와 재사용성이 우수

JPA 사용 시 단점
1. 복잡한 쿼리 처리
- 통계 처리 같은 복잡한 쿼리 경우엔 SQL문이 더 좋다
- Native SQL을 통해 기존 SQL문 사용이 가능하나 특정 데이터베이스에 종속된다는 단점 발생
- 현재 이를 보완하기 위한 SQL과 유사한 기술인 JPQL을 지원

2. 성능 저하 위험
- 객체 간의 매핑 설계를 잘못했을 때 성능 저하 발생 가능
- 자동으로 쿼리를 생성하므로 개발자가 의도하지 않은 쿼리로 성능 저하 가능

3. 학습 시간
- JPA를 제대로 사용할려면 알아야 할 것이 많음


#### JPA 동작 방식
> 엔티티
데이터베이스의 테이블에 대응하는 클래스라고 생각하면 된다. @Entity가 붙은 클래스는 JPA에서 관리하며 엔티티라고 한다. 데이터베이스에 Item 테이블을 만들고 Item.java 클래스를 만들어서 @Entity 어노테이션을 붙이면 이 클래스가 엔티티가 된다.

> 엔티티 매니저 팩토리
엔티티 매니저 인스턴스를 관리하는 주체, 애플리케이션 실행 시 한 개만 만들어지며 사용자로부터 요청이 오면 엔티티 매니저 팩토리로부터 엔티티 매니저를 생성

> 엔티티 매니저
영속성 컨텍스트에 접근하여 엔티티에 대한 데이터베이스 작업을 제공한다. 내부적으로 데이터베이스 커넥션을 사용해서 데이터베이스에 접근한다. 메소드는 다음과 같다

1. find() 
- 엔티티를 검색하고 영속성 컨텍스트에 없을 경우 데이터베이스에서 데이터를 찾아 영속성 컨텍스트에 저장
2. persist()
- 엔티티를 영속성 컨텍스트에 저장
3. remove()
- 엔티티 클래스를 영속성 컨텍스트에서 삭제
4. flush()
- 영속성 컨텍스트에 저장된 내용을 데이터베이스에 반영

##### 영속성 컨텍스트란?
엔티티를 영구 저장하는 환경으로 엔티티 매니저를 통해 영속성 컨텍스트에 접근한다.

<img src="/assets/images/blog/영속성컨텍스트.png" class="img-responsive" alt="">

|생명주기| 내용|
|---|---|
|비영속(new)|new 키워드를 통해 생성된 상태로, 영속성과 관련 없는 상태|
|영속|엔티티가 영속성 컨텍스트에 저장된 상태로 영속성 컨텍스트에 의해 관리되는 상태|
|준영속 상태(detached)|영속성 컨텍스트에서 분리된 상태|
|삭제 상태(remove)|영속성 컨텍스트와 데이터베이스에서 삭제된 상태|
